var tmpl=function(){function a(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},b=/&(?!#?w+;)|<|>|"|'|\//g;return function(){return this?this.replace(b,function(b){return a[b]||b}):this}}String.prototype.encodeHTML=a();var b={};return b["layout-default"]=function(){var a='<header class="row" data-region="header"></header><div class="row" data-region="content"></div><footer class="row" data-region="footer"></footer>';return a},b.logo=function(){var a='<div class="mod mod-logo"><a href="#/">Logo</a></div>';return a},b["navigation-items"]=function(a){var b="",c=a.items;if(c)for(var d,e=-1,f=c.length-1;f>e;){if(d=c[e+=1],b+='<li class="item"><a href="#'+d.link+'"><span>'+d.label+"</span></a>",d.items){b+='<ul class="nav-sub">';var g=d.items;if(g)for(var h,i=-1,j=g.length-1;j>i;)h=g[i+=1],b+='<li class="item"><a href="#'+h.link+'"><span>'+h.label+"</span></a></li>";b+="</ul>"}b+="</li>"}return b},b.navigation=function(){var a='<div class="mod mod-navigation" data-url="/api/navigation/main.json"><nav><ul class="nav"></ul></nav></div>';return a},b}();!function(a){Tc.Module.App=Tc.Module.extend({views:[],$layout:null,loading:!1,on:function(a){a()},after:function(){var b=this;this.$layout=a(".mod-layout"),Path.rescue(b.rescue),a.ajax({url:"/api/app/views.json",method:"GET",dataType:"json",success:function(c){a.each(c.views,function(a,c){b.views[c.id+""]=c,Path.map("#"+c.route).to(function(){b.view(c.id)})}),Path.listen()}})},rescue:function(){console.log("view not found")},view:function(b){var c=this,d=this.views[b],e=this.$layout.data("layout");document.title=d.title;var f=null!=d.layout?d.layout:"iframe";if(e!=f){var g=a(tmpl["layout-"+f]({}));c.$layout.empty().append(g),c.$layout.data("layout",f),c.$layout.removeClass(),c.$layout.addClass("mod mod-layout skin-layout-"+f)}var h=[];if(d.modules){a.each(d.modules,function(b,d){var e=a('[data-region="'+b+'"]',c.$layout);e.empty(),a.each(d,function(b,c){tmpl[c]?($module=a(tmpl[c]({})),e.append($module),h.push($module)):console.log('module "'+c+'" does not exist - skipped')}),c.sandbox.addModules(e)});var i=a("[data-localize]",c.$layout);a.each(i,function(a,b){var c=window.i18n[b.getAttribute("data-localize")||b.innerHTML];c&&(b.innerHTML=c({}))})}}})}(Tc.$),function(a){Tc.Module.Navigation=Tc.Module.extend({$nav:null,on:function(b){this.$nav=a(".nav",this.$ctx),b()},after:function(){this.refresh()},refresh:function(){var b=this.$ctx,c=this;a.ajax({url:b.data("url"),method:"GET",dataType:"json",success:function(b){var d=a(tmpl["navigation-items"](b));c.$nav.empty().append(d)}})}})}(Tc.$);